<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sondaggio</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <script>
    // Forza layout mobile se c'è il parametro ?mobile=1
    if (window.location.search.includes('mobile=1')) {
      document.body.classList.add('force-mobile');
    }
  </script>
  <!-- VIDEO DI SFONDO -->
  <div class="video-background">
    <iframe src="https://www.youtube.com/embed/10wJ6shYnzg?autoplay=1&mute=1&controls=0&showinfo=0&loop=1&playlist=10wJ6shYnzg"
            frameborder="0"
            allow="autoplay; fullscreen"
            allowfullscreen></iframe>
  </div>
  <!-- CONTAINER PRINCIPALE -->
  <div class="container">
    <div class="video-container">
      <!-- NUOVO VIDEO PRINCIPALE INCORPORATO -->
      <iframe width="560" height="315" src="https://www.youtube.com/embed/g9Br3j0fsKc?si=zc3_AtA1o1eLZLHL"
        title="YouTube video player" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
    </div>

    <div class="interaction-panel">
      <h2>Quale opzione preferisci?</h2>
      <div class="buttons-container">
        <div class="option-group">
          <button id="voteA" class="option-button">Opzione A</button>
          <div class="percentage-display" id="percentage-A">0%</div>
        </div>
        <div class="option-group">
          <button id="voteB" class="option-button">Opzione B</button>
          <div class="percentage-display" id="percentage-B">0%</div>
        </div>
      </div>
      <div class="total-clicks" id="totalClicks">0 voti totali</div>
      <p class="voted-message" id="votedMessage" style="display:none;">Hai già votato!</p>
    </div>

    <!-- SLIDER INTEGRATI -->
    <div class="sliders-panel" style="margin-top:30px;">
      <h3>Controlla i parametri:</h3>
      <label for="slider1">Slider 1:</label>
      <input type="range" id="slider1" min="0" max="100" value="50">
      <span id="slider1Value">50</span>
      <br>
      <label for="slider2">Slider 2:</label>
      <input type="range" id="slider2" min="0" max="100" value="25">
      <span id="slider2Value">25</span>
      <br>
    </div>
    <!-- FINE SLIDER -->
  </div>
  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyADP0DV2JbMa6mrofsjkZJRF7Lj6Aq1LC4",
      authDomain: "eburnea-fd632.firebaseapp.com",
      databaseURL: "https://eburnea-fd632-default-rtdb.firebaseio.com",
      projectId: "eburnea-fd632",
      storageBucket: "eburnea-fd632.appspot.com",
      messagingSenderId: "560492313221",
      appId: "1:560492313221:web:e8bd91b5c384c57fe187ec",
      measurementId: "G-CH43LTYK55"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
  <!-- SLIDER WEBSOCKET SCRIPT -->
// SLIDER WEBSOCKET SCRIPT - VERSIONE CORRETTA
<script>
    // Sostituisci con l'URL del tuo server WebSocket!
    const ws = new WebSocket('wss://eburnea-socket-8cd5fa7cffe8.herokuapp.com');

    ws.onopen = function() {
      console.log('WebSocket connesso!');
    };

    ws.onclose = function() {
      console.log('WebSocket disconnesso!');
    };

    ws.onmessage = function(event) {
      console.log('Messaggio dal server:', event.data);
    };

    function handleSlider(sliderId, index) {
      const slider = document.getElementById(sliderId);
      const value = document.getElementById(sliderId + 'Value');

      slider.addEventListener('input', function() {
        // Aggiorna il valore visualizzato
        value.textContent = slider.value;
        
        // Invia il messaggio nel formato richiesto
        if (ws.readyState === WebSocket.OPEN) {
          const message = {
            type: "slider",
            index: index,  // Usa l'indice numerico
            value: parseFloat(slider.value) / 100  // Converti in float tra 0-1
          };
          ws.send(JSON.stringify(message));
          console.log('Inviato:', message);
        }
      });
    }

    // Configura gli slider con i loro indici
    handleSlider('slider1', 0);  // slider1 -> index 0
    handleSlider('slider2', 1);  // slider2 -> index 1

    // Aggiungi più slider se necessario
    // handleSlider('slider3', 2);
    // handleSlider('slider4', 3);
</script>
